# 8.4 Grafana 可视化仪表板

Grafana 为指标/日志/追踪提供统一可视化与告警平台。

## 8.4.1 仪表板设计

- RED/USE 指标视图、错误率/延迟直方图；
- 资源与容量：CPU/内存/连接池/队列深度；
- 追踪与日志联动跳转。

## 8.4.2 模板与分环境

- 使用变量切换 service/namespace/zone；
- 复用 JSON 模板与 GitOps 管理。

## 8.4.3 SLO/SLA 看板（示例 JSON 片段）

```json
{
  "title": "Service SLO Overview",
  "panels": [
    {
      "type": "timeseries",
      "title": "Latency P95/P99",
      "targets": [
        { "expr": "histogram_quantile(0.95, sum(rate(http_server_duration_bucket[5m])) by (le))" },
        { "expr": "histogram_quantile(0.99, sum(rate(http_server_duration_bucket[5m])) by (le))" }
      ]
    },
    {
      "type": "stat",
      "title": "Error Rate",
      "targets": [
        { "expr": "sum(rate(http_requests_total{status=~\"5..\"}[5m])) / sum(rate(http_requests_total[5m]))" }
      ]
    }
  ]
}
```

> 将 JSON 以 GitOps 管理，变量化 `service`/`namespace`；结合 Exemplars 支持从 P99 点跳转到具体 Trace（参见根目录 OTel 指南）。

## 8.4.4 Burn Rate（错误预算消耗率）面板（JSON 片段）

```json
{
  "title": "SLO Burn Rate",
  "panels": [
    {
      "type": "timeseries",
      "title": "BurnRate (5m/1h)",
      "targets": [
        { "expr": "(sum(rate(http_requests_total{status=~\\"5..\\"}[5m])) / sum(rate(http_requests_total[5m]))) / 0.001" },
        { "expr": "(sum(rate(http_requests_total{status=~\\"5..\\"}[1h])) / sum(rate(http_requests_total[1h]))) / 0.001" }
      ]
    },
    {
      "type": "stat",
      "title": "ErrorBudgetRemaining",
      "targets": [
        { "expr": "1 - (sum(increase(http_requests_total{status=~\\"5..\\"}[30d])) / sum(increase(http_requests_total[30d])))" }
      ]
    }
  ]
}
```

> 其中 0.1% 误差预算示例可按产品 SLO 调整；可配合多窗口多阈值告警（Short/Long Window）。
