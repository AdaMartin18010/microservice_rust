# 4.4 自定义服务发现

当外部注册中心不可用或需要轻量方案时，可基于本仓 `ServiceRegistry` 实现进程内/局域服务发现，并逐步演进到外部后端。

## 4.4.1 分层架构

- 接口层：`Registry` trait，屏蔽后端差异；
- 本地实现：内存 HashMap + 心跳；
- 远程实现：适配 Consul/Nacos/etcd。

## 4.4.2 关键能力

- 注册/注销/发现/列举；
- 健康检查与实例打分（健康度/延迟/错误率）；
- 事件订阅（新增/下线/权重变化）。

## 4.4.3 渐进演进

- 单机内存 → 多进程共享（Redis/etcd）→ 跨集群（Consul/Nacos）。
