# 2024 idiom 与 async 接口规范 Checklist

## 目标

- 对齐 Rust 1.90 / edition=2024 的最佳实践，统一接口风格与可读性。

## 接口规范

- 公开 trait：采用 `fn -> impl Future<...> + Send`，避免直接 `async fn`。
- 内部 trait：无需 `dyn` 时优先原生 async 或 `-> impl Future`。
- 需要对象安全：保留 `#[async_trait]`，或提供适配层。

## 代码风格

- 减少 `Pin<Box<dyn Future>>`，能用 `impl Future` 则优先。
- 使用 async 闭包于并发 map/spawn 等场景（示例已覆盖）。
- GAT/异步迭代器：按需引入，保持签名清晰。

## 审核清单（每次提交）

- 构建：`cargo check --workspace --all-targets` 通过。
- Lints：在 Windows 下用 `cargo clippy --no-default-features` 子集运行，聚焦 idiom。
- Examples：关键示例可构建，覆盖原生 async、`dyn`、流/并发。

## 渐进迁移流程

1. 识别需要 `dyn` 的接口，清单化。
2. 内部接口新增或改造为原生写法；调用点逐步替换。
3. 保持双轨一段时间，完成后再评估收敛。

## 常见问题

- `async_fn_in_trait` 提示：对公开 trait 使用 `-> impl Future + Send`。
- 对象安全：避免对外暴露原生 `async fn` trait（除非不走 `dyn`）。
- OpenSSL 依赖：clippy 在 Windows 可使用受限特性集以避免系统依赖。
