# 3.4 Volo å­—èŠ‚è·³åŠ¨ RPC æ¡†æ¶

## ğŸ“‹ ç›®å½•

- [3.4 Volo å­—èŠ‚è·³åŠ¨ RPC æ¡†æ¶](#34-volo-å­—èŠ‚è·³åŠ¨-rpc-æ¡†æ¶)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [3.4.1 å…³é”®ç‰¹æ€§](#341-å…³é”®ç‰¹æ€§)
  - [3.4.2 ä½¿ç”¨å»ºè®®](#342-ä½¿ç”¨å»ºè®®)
  - [3.4.3 ä¸æœ¬ä»“ç»„åˆ](#343-ä¸æœ¬ä»“ç»„åˆ)
  - [3.4.4 å¤šåè®®ä¸ä»£ç ç”Ÿæˆ](#344-å¤šåè®®ä¸ä»£ç ç”Ÿæˆ)
  - [3.4.5 å®¢æˆ·ç«¯æ²»ç†ä¸æœåŠ¡å‘ç°](#345-å®¢æˆ·ç«¯æ²»ç†ä¸æœåŠ¡å‘ç°)
  - [3.4.6 å¯è§‚æµ‹æ€§ï¼ˆTracing/OTelï¼‰](#346-å¯è§‚æµ‹æ€§tracingotel)
  - [3.4.7 TLS/mTLS ä¸é›¶ä¿¡ä»»](#347-tlsmtls-ä¸é›¶ä¿¡ä»»)
  - [3.4.8 æµå¼ã€å¹¶å‘ä¸èƒŒå‹](#348-æµå¼å¹¶å‘ä¸èƒŒå‹)
  - [3.4.9 ä¸æœ¬ä»“ç»„åˆä¸ç¬¬14ç« å¯¹åº”](#349-ä¸æœ¬ä»“ç»„åˆä¸ç¬¬14ç« å¯¹åº”)

Volo æ˜¯åŸºäº `pilota`/`motore` ç­‰è‡ªç ”ç»„ä»¶çš„é«˜æ€§èƒ½ RPC æ¡†æ¶ï¼Œæ”¯æŒ Thrift/Protobuf å¤šåè®®ï¼Œé€‚åˆå¤§è§„æ¨¡å†…éƒ¨æœåŠ¡é€šä¿¡ä¸è·¨è¯­è¨€åœºæ™¯ã€‚

## 3.4.1 å…³é”®ç‰¹æ€§

- é«˜æ€§èƒ½ã€å¼‚æ­¥å‹å¥½ã€å¤šåè®®æ”¯æŒï¼›
- ä¸ `tower` ç±»ä¼¼çš„å±‚æ¬¡åŒ–ä¸­é—´ä»¶æ¨¡å‹ï¼›
- ä¸°å¯Œçš„å®¢æˆ·ç«¯æ²»ç†èƒ½åŠ›ï¼ˆé‡è¯•ã€è¶…æ—¶ã€ç†”æ–­ã€è´Ÿè½½å‡è¡¡ï¼‰ã€‚

## 3.4.2 ä½¿ç”¨å»ºè®®

- å†…éƒ¨å¤§è§„æ¨¡ RPC è°ƒç”¨åœºæ™¯ä¼˜å…ˆï¼›
- ç»“åˆæ³¨å†Œä¸­å¿ƒä¸é…ç½®ä¸­å¿ƒåŠ¨æ€ä¸‹å‘è·¯ç”±ä¸ç­–ç•¥ï¼›
- ä¸ OpenTelemetry å¯¹æ¥ç»Ÿä¸€è¿½è¸ªä¸æŒ‡æ ‡ã€‚

## 3.4.3 ä¸æœ¬ä»“ç»„åˆ

- é€šè¿‡å…¬å…±é¢†åŸŸæ¥å£æŠ½è±¡ï¼ˆå¦‚ `AsyncService`ï¼‰å®ç°ä¸æ¡†æ¶æ— å…³çš„ä¸šåŠ¡å±‚ï¼›
- ä»¥ Volo ä½œä¸ºå†…éƒ¨ RPC ä¸»åŠ›ï¼Œä¸ axum/Actix ä½œä¸ºè¾¹ç¼˜å…¥å£ååŒï¼›
- ç­–ç•¥å±‚ï¼ˆé™æµ/ç†”æ–­/é‡è¯•/è¶…æ—¶/é‡è¯•ï¼‰ç»Ÿä¸€åœ¨ `tower`/Volo å±‚å®ç°ã€‚

## 3.4.4 å¤šåè®®ä¸ä»£ç ç”Ÿæˆ

- æ”¯æŒ Protobuf/Thriftï¼ˆ`pilota`ï¼‰ï¼›æŒ‰å›¢é˜Ÿåè®®é€‰æ‹©ï¼›ç»Ÿä¸€åœ¨ `build.rs` ç”Ÿæˆè‡³ `src/gen`ã€‚

## 3.4.5 å®¢æˆ·ç«¯æ²»ç†ä¸æœåŠ¡å‘ç°

```rust
// ä¼ªä»£ç ï¼šå±•ç¤ºé‡è¯•/è¶…æ—¶/è´Ÿè½½å‡è¡¡/å‘ç°çš„ç»„åˆä½ç‚¹
fn volo_client() -> Client {
    Client::builder()
        .with_timeout(Duration::from_millis(1500))
        .with_retry(RetryPolicy::exponential_backoff(3))
        .with_load_balance(LoadBalance::LeastRequests)
        .with_resolver(EtcdResolver::new(["http://etcd:2379"]))
        .build()
}
```

- è·¯ç”±ä¸ç­–ç•¥å¯ç”±é…ç½®ä¸­å¿ƒçƒ­æ›´æ–°ï¼›ä¸ 14.2 è“å›¾ä¸€è‡´ã€‚

## 3.4.6 å¯è§‚æµ‹æ€§ï¼ˆTracing/OTelï¼‰

```rust
// æ¥å…¥ tracing_subscriber + otlpï¼Œä¸ axum/tonic ç»Ÿä¸€
tracing_subscriber::registry()
    .with(tracing_subscriber::fmt::layer())
    .with(tracing_opentelemetry::layer().with_tracer(tracer))
    .init();
```

## 3.4.7 TLS/mTLS ä¸é›¶ä¿¡ä»»

- ä¸ SPIFFE/SPIRE é›†æˆçŸ­è¯ä¹¦ï¼›æˆ–å¤ç”¨ Mesh mTLSï¼Œåº”ç”¨å±‚å‡å°‘é‡å¤åŠ å¯†ã€‚

## 3.4.8 æµå¼ã€å¹¶å‘ä¸èƒŒå‹

- Server/Client streamingï¼šä¸ºçƒ­ç‚¹æ¥å£è®¾ç½®é˜Ÿåˆ—ä¸Šé™ä¸é€Ÿç‡ï¼›ç»Ÿè®¡ P95/P99ã€‚
- å¹¶å‘æ§åˆ¶ï¼šç”¨ä¿¡å·é‡éš”ç¦»ä¸‹æ¸¸æŠ–åŠ¨ï¼›é¿å…çº§è”æ•…éšœï¼ˆè§ 14.5ï¼‰ã€‚

## 3.4.9 ä¸æœ¬ä»“ç»„åˆä¸ç¬¬14ç« å¯¹åº”

- é€šè¿‡ `AsyncService` ç»Ÿä¸€é¢†åŸŸé€»è¾‘ï¼Œè¾¹ç¼˜ï¼ˆaxumï¼‰ä¸å†…éƒ¨ï¼ˆVolo/tonicï¼‰å¤ç”¨å®ç°ã€‚
- 14.2/14.5ï¼šä¼ä¸š RPC ä¸ Mesh é›¶ä¿¡ä»»ï¼›14.6ï¼šå¤šç§Ÿæˆ·è·¯ç”±ä¸é…é¢ã€‚
