# ç«¯åˆ°ç«¯ç”Ÿäº§åŸºçº¿Â·è½åœ°ç´¢å¼•

> åŸºäºRust 1.90å’Œ2025å¹´æœ€æ–°æŠ€æœ¯æ ˆçš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†ä»å¼€å‘åˆ°ç”Ÿäº§çš„å®Œæ•´è½åœ°è·¯å¾„ï¼ŒåŒ…å«å‚æ•°æ¨¡æ¿ã€éªŒæ”¶æ¸…å•ã€SLOæ ·ä¾‹å’Œé£é™©å›æ»šç­–ç•¥ï¼Œç¡®ä¿å¾®æœåŠ¡ç³»ç»Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„ç¨³å®šè¿è¡Œã€‚

## ğŸ¯ è½åœ°è·¯å¾„å›¾

```mermaid
graph TD
    A[å¼€å‘ç¯å¢ƒ] --> B[æµ‹è¯•ç¯å¢ƒ]
    B --> C[é¢„ç”Ÿäº§ç¯å¢ƒ]
    C --> D[ç”Ÿäº§ç¯å¢ƒ]
    
    A --> A1[æœ¬åœ°å¼€å‘]
    A --> A2[å•å…ƒæµ‹è¯•]
    A --> A3[é›†æˆæµ‹è¯•]
    
    B --> B1[åŠŸèƒ½æµ‹è¯•]
    B --> B2[æ€§èƒ½æµ‹è¯•]
    B --> B3[å®‰å…¨æµ‹è¯•]
    
    C --> C1[å‹åŠ›æµ‹è¯•]
    C --> C2[æ··æ²Œå·¥ç¨‹]
    C --> C3[ç›‘æ§éªŒè¯]
    
    D --> D1[ç°åº¦å‘å¸ƒ]
    D --> D2[å…¨é‡å‘å¸ƒ]
    D --> D3[ç›‘æ§å‘Šè­¦]
```

## ğŸ› ï¸ å‚æ•°æ¨¡æ¿

### 1. åŸºç¡€é…ç½®æ¨¡æ¿

```toml
# config/production.toml
[server]
host = "0.0.0.0"
port = 8080
workers = 4
max_connections = 10000

[logging]
level = "info"
format = "json"
output = "stdout"

[metrics]
enabled = true
port = 9090
path = "/metrics"

[health]
enabled = true
path = "/health"
timeout = "5s"

[rate_limiting]
enabled = true
requests_per_minute = 1000
burst_size = 100

[circuit_breaker]
enabled = true
failure_threshold = 5
recovery_timeout = "30s"
```

### 2. æ•°æ®åº“é…ç½®æ¨¡æ¿

```toml
[database]
url = "postgresql://user:password@localhost:5432/microservice"
max_connections = 20
min_connections = 5
connection_timeout = "30s"
idle_timeout = "600s"

[redis]
url = "redis://localhost:6379"
max_connections = 10
connection_timeout = "5s"
```

### 3. æ¶ˆæ¯é˜Ÿåˆ—é…ç½®æ¨¡æ¿

```toml
[rabbitmq]
url = "amqp://user:password@localhost:5672"
exchange = "microservice"
queue = "tasks"
prefetch_count = 10

[kafka]
bootstrap_servers = ["localhost:9092"]
topic = "events"
group_id = "microservice-group"
```

### 4. ç›‘æ§é…ç½®æ¨¡æ¿

```toml
[opentelemetry]
enabled = true
endpoint = "http://jaeger:14268/api/traces"
service_name = "microservice"
service_version = "1.0.0"

[prometheus]
enabled = true
port = 9090
path = "/metrics"

[grafana]
enabled = true
port = 3000
```

## ğŸ“Š éªŒæ”¶æ¸…å•

### 1. åŠŸèƒ½éªŒæ”¶

- [ ] **APIæ¥å£æµ‹è¯•**
  - [ ] æ‰€æœ‰REST APIå“åº”æ­£å¸¸
  - [ ] gRPCæœåŠ¡è°ƒç”¨æˆåŠŸ
  - [ ] GraphQLæŸ¥è¯¢æ‰§è¡Œæ­£ç¡®
  - [ ] WebSocketè¿æ¥ç¨³å®š

- [ ] **æ•°æ®ä¸€è‡´æ€§éªŒè¯**
  - [ ] æ•°æ®åº“äº‹åŠ¡æ­£ç¡®æ‰§è¡Œ
  - [ ] æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆæ¯ä¸ä¸¢å¤±
  - [ ] ç¼“å­˜æ•°æ®ä¸€è‡´æ€§
  - [ ] åˆ†å¸ƒå¼é”æ­£å¸¸å·¥ä½œ

- [ ] **å®‰å…¨åŠŸèƒ½éªŒè¯**
  - [ ] JWTè®¤è¯æ­£å¸¸å·¥ä½œ
  - [ ] OAuth2æˆæƒæµç¨‹æ­£ç¡®
  - [ ] TLSåŠ å¯†é€šä¿¡æ­£å¸¸
  - [ ] è¾“å…¥éªŒè¯å’Œé˜²æŠ¤ç”Ÿæ•ˆ

### 2. æ€§èƒ½éªŒæ”¶

- [ ] **å“åº”æ—¶é—´**
  - [ ] APIå“åº”æ—¶é—´ < 100ms (P95)
  - [ ] æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ < 50ms (P95)
  - [ ] æ¶ˆæ¯å¤„ç†å»¶è¿Ÿ < 10ms (P95)
  - [ ] ç¼“å­˜å‘½ä¸­ç‡ > 90%

- [ ] **ååé‡**
  - [ ] æ”¯æŒ1000+ QPS
  - [ ] å¹¶å‘è¿æ¥æ•° > 10000
  - [ ] æ¶ˆæ¯å¤„ç†é€Ÿç‡ > 10000/s
  - [ ] æ•°æ®åº“è¿æ¥æ± åˆ©ç”¨ç‡ < 80%

- [ ] **èµ„æºä½¿ç”¨**
  - [ ] CPUä½¿ç”¨ç‡ < 70%
  - [ ] å†…å­˜ä½¿ç”¨ç‡ < 80%
  - [ ] ç£ç›˜I/O < 80%
  - [ ] ç½‘ç»œå¸¦å®½ä½¿ç”¨ < 70%

### 3. å¯é æ€§éªŒæ”¶

- [ ] **æ•…éšœæ¢å¤**
  - [ ] æœåŠ¡é‡å¯åè‡ªåŠ¨æ¢å¤
  - [ ] æ•°æ®åº“æ•…éšœè‡ªåŠ¨åˆ‡æ¢
  - [ ] æ¶ˆæ¯é˜Ÿåˆ—æ•…éšœå¤„ç†
  - [ ] ç½‘ç»œåˆ†åŒºæ¢å¤

- [ ] **æ•°æ®å¤‡ä»½**
  - [ ] æ•°æ®åº“å®šæœŸå¤‡ä»½
  - [ ] é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶
  - [ ] æ—¥å¿—æ–‡ä»¶å½’æ¡£
  - [ ] ç›‘æ§æ•°æ®ä¿ç•™

### 4. å®‰å…¨éªŒæ”¶

- [ ] **è®¿é—®æ§åˆ¶**
  - [ ] ç”¨æˆ·æƒé™éªŒè¯
  - [ ] APIè®¿é—®é™åˆ¶
  - [ ] æ•æ„Ÿæ•°æ®åŠ å¯†
  - [ ] å®¡è®¡æ—¥å¿—è®°å½•

- [ ] **æ¼æ´æ‰«æ**
  - [ ] ä¾èµ–åº“å®‰å…¨æ‰«æ
  - [ ] ä»£ç å®‰å…¨å®¡è®¡
  - [ ] ç½‘ç»œç«¯å£æ‰«æ
  - [ ] é…ç½®å®‰å…¨æ£€æŸ¥

## ğŸ“ˆ SLOæ ·ä¾‹

### 1. å¯ç”¨æ€§SLO

```yaml
# SLOé…ç½®ç¤ºä¾‹
availability:
  target: 99.9%
  measurement_window: 30d
  error_budget: 0.1%
  
latency:
  target: 100ms
  measurement_window: 7d
  percentile: 95
  
throughput:
  target: 1000 RPS
  measurement_window: 1h
  minimum: 800 RPS
```

### 2. æ€§èƒ½SLO

```yaml
performance:
  api_response_time:
    target: 100ms
    percentile: 95
    measurement_window: 24h
    
  database_query_time:
    target: 50ms
    percentile: 95
    measurement_window: 24h
    
  message_processing_time:
    target: 10ms
    percentile: 95
    measurement_window: 1h
```

### 3. é”™è¯¯ç‡SLO

```yaml
error_rate:
  http_errors:
    target: 0.1%
    measurement_window: 24h
    
  grpc_errors:
    target: 0.05%
    measurement_window: 24h
    
  database_errors:
    target: 0.01%
    measurement_window: 24h
```

## ğŸš¨ é£é™©ä¸å›æ»šç­–ç•¥

### 1. éƒ¨ç½²é£é™©

| é£é™©ç±»å‹ | å½±å“ç¨‹åº¦ | æ¦‚ç‡ | ç¼“è§£æªæ–½ | å›æ»šç­–ç•¥ |
|----------|----------|------|----------|----------|
| é…ç½®é”™è¯¯ | é«˜ | ä¸­ | é…ç½®éªŒè¯ | å¿«é€Ÿå›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ |
| ä¾èµ–å†²çª | é«˜ | ä½ | ä¾èµ–æµ‹è¯• | å›æ»šä¾èµ–ç‰ˆæœ¬ |
| æ€§èƒ½é€€åŒ– | ä¸­ | ä¸­ | æ€§èƒ½æµ‹è¯• | è°ƒæ•´èµ„æºé…ç½® |
| æ•°æ®ä¸¢å¤± | é«˜ | ä½ | æ•°æ®å¤‡ä»½ | æ•°æ®æ¢å¤ |
| å®‰å…¨æ¼æ´ | é«˜ | ä½ | å®‰å…¨æ‰«æ | ç´§æ€¥è¡¥ä¸ |

### 2. å›æ»šç­–ç•¥

#### 2.1 å¿«é€Ÿå›æ»š

```bash
#!/bin/bash
# scripts/quick_rollback.sh

echo "ğŸš¨ æ‰§è¡Œå¿«é€Ÿå›æ»š..."

# 1. åœæ­¢å½“å‰æœåŠ¡
kubectl scale deployment microservice --replicas=0

# 2. å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
kubectl rollout undo deployment/microservice

# 3. éªŒè¯å›æ»šçŠ¶æ€
kubectl rollout status deployment/microservice

# 4. æ£€æŸ¥æœåŠ¡å¥åº·
kubectl get pods -l app=microservice

echo "âœ… å›æ»šå®Œæˆ"
```

#### 2.2 æ•°æ®å›æ»š

```bash
#!/bin/bash
# scripts/data_rollback.sh

echo "ğŸ”„ æ‰§è¡Œæ•°æ®å›æ»š..."

# 1. åœæ­¢å†™å…¥æ“ä½œ
kubectl patch deployment microservice -p '{"spec":{"replicas":0}}'

# 2. æ¢å¤æ•°æ®åº“å¤‡ä»½
pg_restore -h localhost -U postgres -d microservice backup_$(date -d '1 day ago' +%Y%m%d).sql

# 3. éªŒè¯æ•°æ®å®Œæ•´æ€§
psql -h localhost -U postgres -d microservice -c "SELECT COUNT(*) FROM users;"

# 4. é‡å¯æœåŠ¡
kubectl scale deployment microservice --replicas=3

echo "âœ… æ•°æ®å›æ»šå®Œæˆ"
```

### 3. ç›‘æ§å‘Šè­¦

#### 3.1 å…³é”®æŒ‡æ ‡å‘Šè­¦

```yaml
# prometheus/alerts.yml
groups:
  - name: microservice
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.01
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High error rate detected"
          
      - alert: HighLatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High latency detected"
          
      - alert: ServiceDown
        expr: up{job="microservice"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Service is down"
```

#### 3.2 å‘Šè­¦é€šçŸ¥

```yaml
# alertmanager/config.yml
route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'

receivers:
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://alertmanager:9093/webhook'
        send_resolved: true
```

## ğŸ”§ éƒ¨ç½²è„šæœ¬

### 1. ç”Ÿäº§éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# scripts/production_deploy.sh

set -e

echo "ğŸš€ å¼€å§‹ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²..."

# 1. ç¯å¢ƒæ£€æŸ¥
echo "æ£€æŸ¥ç¯å¢ƒ..."
kubectl cluster-info
kubectl get nodes

# 2. é…ç½®éªŒè¯
echo "éªŒè¯é…ç½®..."
kubectl apply --dry-run=client -f k8s/

# 3. æ„å»ºé•œåƒ
echo "æ„å»ºé•œåƒ..."
docker build -t microservice:latest .
docker tag microservice:latest registry.example.com/microservice:latest
docker push registry.example.com/microservice:latest

# 4. éƒ¨ç½²åº”ç”¨
echo "éƒ¨ç½²åº”ç”¨..."
kubectl apply -f k8s/

# 5. ç­‰å¾…éƒ¨ç½²å®Œæˆ
echo "ç­‰å¾…éƒ¨ç½²å®Œæˆ..."
kubectl rollout status deployment/microservice

# 6. å¥åº·æ£€æŸ¥
echo "å¥åº·æ£€æŸ¥..."
kubectl get pods -l app=microservice
kubectl get services

# 7. éªŒè¯æœåŠ¡
echo "éªŒè¯æœåŠ¡..."
curl -f http://localhost:8080/health

echo "âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®Œæˆ"
```

### 2. ç°åº¦å‘å¸ƒè„šæœ¬

```bash
#!/bin/bash
# scripts/canary_deploy.sh

set -e

echo "ğŸ¯ å¼€å§‹ç°åº¦å‘å¸ƒ..."

# 1. åˆ›å»ºç°åº¦ç‰ˆæœ¬
echo "åˆ›å»ºç°åº¦ç‰ˆæœ¬..."
kubectl apply -f k8s/canary/

# 2. é€æ­¥å¢åŠ æµé‡
echo "é€æ­¥å¢åŠ æµé‡..."
for i in 10 25 50 75 100; do
    echo "è®¾ç½®æµé‡æ¯”ä¾‹: ${i}%"
    kubectl patch service microservice -p "{\"spec\":{\"selector\":{\"version\":\"canary\"}}}"
    sleep 60
    
    # æ£€æŸ¥é”™è¯¯ç‡
    error_rate=$(curl -s http://localhost:9090/metrics | grep 'http_requests_total{status=~"5.."}' | awk '{print $2}')
    if [ "$error_rate" -gt 10 ]; then
        echo "âŒ é”™è¯¯ç‡è¿‡é«˜ï¼Œå›æ»šç°åº¦å‘å¸ƒ"
        kubectl patch service microservice -p "{\"spec\":{\"selector\":{\"version\":\"stable\"}}}"
        exit 1
    fi
done

# 3. å®Œæˆç°åº¦å‘å¸ƒ
echo "å®Œæˆç°åº¦å‘å¸ƒ..."
kubectl delete deployment microservice-stable

echo "âœ… ç°åº¦å‘å¸ƒå®Œæˆ"
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. éƒ¨ç½²æœ€ä½³å®è·µ

- âœ… **æ¸è¿›å¼éƒ¨ç½²**ï¼šä½¿ç”¨ç°åº¦å‘å¸ƒé™ä½é£é™©
- âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šå‡å°‘äººä¸ºé”™è¯¯
- âœ… **é…ç½®ç®¡ç†**ï¼šä½¿ç”¨é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†
- âœ… **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ‰€æœ‰é…ç½®å’Œä»£ç éƒ½è¦ç‰ˆæœ¬æ§åˆ¶

### 2. ç›‘æ§æœ€ä½³å®è·µ

- âœ… **å…¨é“¾è·¯ç›‘æ§**ï¼šä»ç”¨æˆ·è¯·æ±‚åˆ°æ•°æ®åº“æŸ¥è¯¢
- âœ… **å…³é”®æŒ‡æ ‡**ï¼šå…³æ³¨å¯ç”¨æ€§ã€å»¶è¿Ÿã€é”™è¯¯ç‡
- âœ… **å‘Šè­¦ç­–ç•¥**ï¼šè®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼
- âœ… **æ—¥å¿—ç®¡ç†**ï¼šç»“æ„åŒ–æ—¥å¿—ï¼Œä¾¿äºåˆ†æ

### 3. å®‰å…¨æœ€ä½³å®è·µ

- âœ… **æœ€å°æƒé™**ï¼šæœåŠ¡åªæ‹¥æœ‰å¿…è¦æƒé™
- âœ… **ç½‘ç»œå®‰å…¨**ï¼šä½¿ç”¨ç½‘ç»œç­–ç•¥é™åˆ¶è®¿é—®
- âœ… **æ•°æ®åŠ å¯†**ï¼šä¼ è¾“å’Œå­˜å‚¨éƒ½è¦åŠ å¯†
- âœ… **å®šæœŸå®¡è®¡**ï¼šå®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡

### 4. è¿ç»´æœ€ä½³å®è·µ

- âœ… **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šä½¿ç”¨å·¥å…·è‡ªåŠ¨åŒ–è¿ç»´ä»»åŠ¡
- âœ… **æ•…éšœæ¼”ç»ƒ**ï¼šå®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- âœ… **å®¹é‡è§„åˆ’**ï¼šæ ¹æ®ä¸šåŠ¡å¢é•¿è§„åˆ’å®¹é‡
- âœ… **æ–‡æ¡£ç»´æŠ¤**ï¼šä¿æŒæ–‡æ¡£çš„åŠæ—¶æ›´æ–°

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é…ç½®ç®¡ç†ç­–ç•¥](./10_é…ç½®ç®¡ç†ä¸éƒ¨ç½²/10.1_é…ç½®ç®¡ç†ç­–ç•¥.md)
- [Kubernetesç¼–æ’](./10_é…ç½®ç®¡ç†ä¸éƒ¨ç½²/10.3_Kubernetes_ç¼–æ’.md)
- [OpenTelemetryå¯è§‚æµ‹æ€§](./08_å¯è§‚æµ‹æ€§ä¸ç›‘æ§/8.1_OpenTelemetry_å¯è§‚æµ‹æ€§.md)
- [å¾®æœåŠ¡å®‰å…¨æœ€ä½³å®è·µ](./09_å®‰å…¨ä¸è®¤è¯/9.4_å¾®æœåŠ¡å®‰å…¨æœ€ä½³å®è·µ.md)
- [æ€§èƒ½åŸºå‡†æµ‹è¯•](./11_æ€§èƒ½ä¼˜åŒ–ä¸æµ‹è¯•/11.1_æ€§èƒ½åŸºå‡†æµ‹è¯•.md)
- [æ··æ²Œå·¥ç¨‹ä¸å®¹é”™è®¾è®¡](./16_é«˜çº§å¾®æœåŠ¡æ¨¡å¼/16.4_æ··æ²Œå·¥ç¨‹ä¸å®¹é”™è®¾è®¡.md)

## ğŸ“ æ›´æ–°æ—¥å¿—

- **2025-01-XX**: åˆå§‹ç‰ˆæœ¬åˆ›å»º
- **2025-01-XX**: æ·»åŠ ä¾èµ–å‡çº§ç›¸å…³å†…å®¹
- **2025-01-XX**: å®Œå–„ç›‘æ§å’Œå‘Šè­¦é…ç½®
- **2025-01-XX**: å¢åŠ ç°åº¦å‘å¸ƒç­–ç•¥

---

**æ³¨æ„**ï¼šæœ¬æ–‡æ¡£åŸºäºRust 1.90å’Œ2025å¹´æœ€æ–°æŠ€æœ¯æ ˆï¼Œå»ºè®®å®šæœŸæ›´æ–°ä»¥ä¿æŒæ—¶æ•ˆæ€§ã€‚
