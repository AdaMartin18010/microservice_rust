# 14.12 ç«¯åˆ°ç«¯ç”Ÿäº§åŸºçº¿Â·è½åœ°ç´¢å¼•

> å¾®æœåŠ¡æ¶æ„ä»è®¾è®¡åˆ°éƒ¨ç½²çš„å®Œæ•´ç”Ÿäº§çº§å®æ–½æŒ‡å—

## ğŸ“‹ ç›®å½•

- [è½åœ°è·¯å¾„å›¾](#è½åœ°è·¯å¾„å›¾)
- [å‚æ•°æ¨¡æ¿åº“](#å‚æ•°æ¨¡æ¿åº“)
- [éªŒæ”¶æ¸…å•](#éªŒæ”¶æ¸…å•)
- [SLOæ ·ä¾‹](#sloæ ·ä¾‹)
- [é£é™©ä¸å›æ»šç­–ç•¥](#é£é™©ä¸å›æ»šç­–ç•¥)
- [å¿«é€Ÿå¼€å§‹æ¨¡æ¿](#å¿«é€Ÿå¼€å§‹æ¨¡æ¿)

## è½åœ°è·¯å¾„å›¾

### é˜¶æ®µ1ï¼šåŸºç¡€å‡†å¤‡ï¼ˆ0-3ä¸ªæœˆï¼‰

**å…³é”®é‡Œç¨‹ç¢‘ï¼š**

- [ ] å›¢é˜ŸRustæŠ€èƒ½è¾¾åˆ°ä¸­çº§æ°´å¹³
- [ ] é€‰å®šæ ¸å¿ƒæ¡†æ¶ï¼ˆAxum/Actix/Tonicï¼‰
- [ ] å»ºç«‹K8sé›†ç¾¤
- [ ] é…ç½®GitLab/GitHub Actions
- [ ] éƒ¨ç½²Prometheus+Grafana

### é˜¶æ®µ2ï¼šè¯•ç‚¹å®æ–½ï¼ˆ3-6ä¸ªæœˆï¼‰

**å…³é”®é‡Œç¨‹ç¢‘ï¼š**

- [ ] å®Œæˆç”¨æˆ·æœåŠ¡è¯•ç‚¹
- [ ] å»ºç«‹æœåŠ¡é—´é€šä¿¡æ ‡å‡†
- [ ] å®ç°åˆ†å¸ƒå¼è¿½è¸ª
- [ ] è¾¾åˆ°æ€§èƒ½åŸºå‡†
- [ ] å»ºç«‹æ•…éšœå¤„ç†æµç¨‹

### é˜¶æ®µ3ï¼šè§„æ¨¡åŒ–æ¨å¹¿ï¼ˆ6-12ä¸ªæœˆï¼‰

**å…³é”®é‡Œç¨‹ç¢‘ï¼š**

- [ ] å®Œæˆæ ¸å¿ƒä¸šåŠ¡æœåŠ¡æ‹†åˆ†
- [ ] å»ºç«‹æœåŠ¡ç½‘æ ¼
- [ ] å®ç°é›¶ä¿¡ä»»å®‰å…¨
- [ ] è¾¾åˆ°SLOç›®æ ‡
- [ ] å»ºç«‹è‡ªåŠ¨åŒ–è¿ç»´

## å‚æ•°æ¨¡æ¿åº“

### 1. æœåŠ¡é…ç½®æ¨¡æ¿

```yaml
# service-config.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: microservice-config
data:
  # æ•°æ®åº“é…ç½®
  DATABASE_URL: "postgresql://user:password@postgres:5432/microservice"
  DATABASE_MAX_CONNECTIONS: "20"
  DATABASE_MIN_CONNECTIONS: "5"
  DATABASE_CONNECTION_TIMEOUT: "30s"
  DATABASE_IDLE_TIMEOUT: "600s"
  
  # Redisé…ç½®
  REDIS_URL: "redis://redis:6379"
  REDIS_POOL_SIZE: "10"
  REDIS_TIMEOUT: "5s"
  
  # æœåŠ¡é…ç½®
  SERVICE_NAME: "user-service"
  SERVICE_VERSION: "1.0.0"
  SERVICE_PORT: "8080"
  SERVICE_HOST: "0.0.0.0"
  
  # æ—¥å¿—é…ç½®
  LOG_LEVEL: "info"
  LOG_FORMAT: "json"
  
  # ç›‘æ§é…ç½®
  METRICS_ENABLED: "true"
  METRICS_PORT: "9090"
  HEALTH_CHECK_INTERVAL: "30s"
  
  # å®‰å…¨é…ç½®
  JWT_SECRET: "your-secret-key"
  JWT_EXPIRY: "24h"
  TLS_ENABLED: "true"
  
  # æ€§èƒ½é…ç½®
  MAX_REQUEST_SIZE: "10MB"
  REQUEST_TIMEOUT: "30s"
  KEEP_ALIVE_TIMEOUT: "75s"
```

## éªŒæ”¶æ¸…å•

### åŠŸèƒ½éªŒæ”¶

- [ ] **APIè®¾è®¡**
  - [ ] RESTful APIè®¾è®¡è§„èŒƒ
  - [ ] OpenAPIæ–‡æ¡£å®Œæ•´
  - [ ] APIç‰ˆæœ¬ç®¡ç†ç­–ç•¥
  - [ ] é”™è¯¯ç æ ‡å‡†åŒ–

- [ ] **æ•°æ®ç®¡ç†**
  - [ ] æ•°æ®åº“è¿æ¥æ± é…ç½®
  - [ ] äº‹åŠ¡è¾¹ç•Œæ¸…æ™°
  - [ ] æ•°æ®è¿ç§»è„šæœ¬
  - [ ] å¤‡ä»½æ¢å¤ç­–ç•¥

- [ ] **æœåŠ¡é€šä¿¡**
  - [ ] æœåŠ¡å‘ç°æœºåˆ¶
  - [ ] è´Ÿè½½å‡è¡¡ç­–ç•¥
  - [ ] ç†”æ–­å™¨é…ç½®
  - [ ] é‡è¯•æœºåˆ¶

### æ€§èƒ½éªŒæ”¶

- [ ] **å“åº”æ—¶é—´**
  - [ ] P50 < 100ms
  - [ ] P95 < 500ms
  - [ ] P99 < 1000ms

- [ ] **ååé‡**
  - [ ] æ”¯æŒ1000+ QPS
  - [ ] å¹¶å‘è¿æ¥æ•° > 1000
  - [ ] å†…å­˜ä½¿ç”¨ < 512MB

- [ ] **å¯ç”¨æ€§**
  - [ ] 99.9% å¯ç”¨æ€§
  - [ ] æ•…éšœæ¢å¤æ—¶é—´ < 5åˆ†é’Ÿ
  - [ ] æ•°æ®ä¸¢å¤±ç‡ = 0

## SLOæ ·ä¾‹

### 1. å»¶è¿ŸSLO

```yaml
# latency-slo.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: user-service-slo-rules
spec:
  groups:
  - name: user-service-slo
    rules:
    - alert: HighLatency
      expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.5
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: "High latency detected"
        description: "95th percentile latency is above 500ms"
```

## é£é™©ä¸å›æ»šç­–ç•¥

### 1. éƒ¨ç½²é£é™©çŸ©é˜µ

| é£é™©ç±»å‹ | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ | å›æ»šç­–ç•¥ |
|---------|------|------|----------|----------|
| æ•°æ®åº“è¿æ¥å¤±è´¥ | ä¸­ | é«˜ | è¿æ¥æ± é¢„çƒ­ | å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ |
| å†…å­˜æ³„æ¼ | ä½ | é«˜ | å†…å­˜ç›‘æ§ | é‡å¯æœåŠ¡å®ä¾‹ |
| é…ç½®é”™è¯¯ | ä¸­ | ä¸­ | é…ç½®éªŒè¯ | å›æ»šé…ç½® |
| ç½‘ç»œåˆ†åŒº | ä½ | é«˜ | å¤šå¯ç”¨åŒºéƒ¨ç½² | æµé‡åˆ‡æ¢ |
| ä¾èµ–æœåŠ¡æ•…éšœ | ä¸­ | ä¸­ | ç†”æ–­å™¨ | é™çº§å¤„ç† |

## å¿«é€Ÿå¼€å§‹æ¨¡æ¿

### 1. ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# quick-deploy.sh

set -e

echo "ğŸš€ å¼€å§‹å¾®æœåŠ¡å¿«é€Ÿéƒ¨ç½²"

# 1. æ£€æŸ¥ç¯å¢ƒ
echo "æ£€æŸ¥ç¯å¢ƒä¾èµ–..."
kubectl version --client
docker version
helm version

# 2. åˆ›å»ºå‘½åç©ºé—´
echo "åˆ›å»ºå‘½åç©ºé—´..."
kubectl create namespace microservice --dry-run=client -o yaml | kubectl apply -f -

# 3. éƒ¨ç½²åŸºç¡€è®¾æ–½
echo "éƒ¨ç½²åŸºç¡€è®¾æ–½..."
helm repo add bitnami https://charts.bitnami.com/bitnami
helm repo update

# éƒ¨ç½²PostgreSQL
helm install postgres bitnami/postgresql \
  --namespace microservice \
  --set auth.postgresPassword=password \
  --set auth.database=microservice

# éƒ¨ç½²Redis
helm install redis bitnami/redis \
  --namespace microservice \
  --set auth.password=password

# 4. éƒ¨ç½²ç›‘æ§
echo "éƒ¨ç½²ç›‘æ§ç³»ç»Ÿ..."
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install prometheus prometheus-community/kube-prometheus-stack \
  --namespace microservice

# 5. éƒ¨ç½²æœåŠ¡
echo "éƒ¨ç½²å¾®æœåŠ¡..."
kubectl apply -f k8s/ -n microservice

# 6. ç­‰å¾…æœåŠ¡å°±ç»ª
echo "ç­‰å¾…æœåŠ¡å°±ç»ª..."
kubectl wait --for=condition=available --timeout=300s deployment/user-service -n microservice

# 7. éªŒè¯éƒ¨ç½²
echo "éªŒè¯éƒ¨ç½²..."
kubectl get pods -n microservice
kubectl get services -n microservice

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "è®¿é—®åœ°å€:"
echo "  - æœåŠ¡: http://localhost:8080"
echo "  - ç›‘æ§: http://localhost:3000"
echo "  - APIæ–‡æ¡£: http://localhost:8080/docs"
```

## æ€»ç»“

æœ¬è½åœ°ç´¢å¼•æä¾›äº†å¾®æœåŠ¡æ¶æ„ä»è®¾è®¡åˆ°éƒ¨ç½²çš„å®Œæ•´æŒ‡å—ï¼ŒåŒ…æ‹¬è½åœ°è·¯å¾„å›¾ã€å‚æ•°æ¨¡æ¿åº“ã€éªŒæ”¶æ¸…å•ã€SLOæ ·ä¾‹ã€é£é™©ç®¡ç†å’Œå¿«é€Ÿå¼€å§‹æ¨¡æ¿ï¼Œç¡®ä¿å¾®æœåŠ¡æ¶æ„çš„æˆåŠŸå®æ–½å’Œç¨³å®šè¿è¡Œã€‚
