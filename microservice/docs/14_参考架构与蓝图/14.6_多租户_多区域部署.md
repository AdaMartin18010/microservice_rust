# 14.6 多租户与多区域部署

- 隔离模型：逻辑隔离（tenant_id）/ 物理隔离（独立集群/账户）
- 数据一致性：读本地写主/多主冲突解决；CRDT（特定场景）
- 流量调度：全局流量管理器（GeoDNS/Global LB）；就近接入
- 合规：数据驻留与脱敏；审计与密钥管理（KMS）

## 关键落地点

- 模式：单实例多租户（性价比）→ 多实例多租户（隔离）
- Rust 1.90：配置热更新与策略注入；按租户维度限流/配额
- 可观测：按租户维度指标/追踪标签；账单与成本核算

## 最小可行组合（MVP）

Kubernetes 多区域 + Global LB + 配置中心 + OTel + 合规管控

## 最小配置模板（片段）

```yaml
# k8s/ingress-tenant-route.yaml（按租户路由示例）
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: tenant-gateway
  annotations:
    traefik.ingress.kubernetes.io/router.middlewares: tenant-header@kubernetescrd
spec:
  rules:
    - host: t1.api.example.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service: { name: user-svc-t1, port: { number: 3000 } }
    - host: t2.api.example.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service: { name: user-svc-t2, port: { number: 3000 } }
```

- 指标：在应用指标/追踪上打 `tenant_id` 标签，用于成本核算与限额。
