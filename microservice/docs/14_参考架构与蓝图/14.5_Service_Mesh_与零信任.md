# 14.5 Service Mesh 与零信任

- Mesh：Istio/Linkerd；身份：SPIFFE/SPIRE；加密：mTLS 全面落地
- 网关：Ingress/Egress Gateway；策略：OPA/Gatekeeper + Kyverno
- 遥测：OTel 接入 Mesh 遥测；指标/追踪/日志统一聚合
- 金丝雀：使用 Istio VirtualService + DestinationRule 切流

## 关键落地点

- Rust 服务内：最小化自带重试，避免与 sidecar 策略叠加震荡
- 证书轮换：短证书 + 自动轮换；证书热加载
- 超时与熔断：与 Mesh 策略对齐，透传响应码与错误分类

## 最小可行组合（MVP）

Istio + SPIRE + OTel Collector + Prometheus/Tempo/Grafana + Kubernetes

## 最小配置模板（片段）

```yaml
# istio/canary.yaml（片段）
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: user-svc
spec:
  host: user-svc
  subsets:
    - name: v1
      labels: { version: v1 }
    - name: v2
      labels: { version: v2 }
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: user-svc
spec:
  hosts: ["user-svc"]
  http:
    - route:
        - destination: { host: user-svc, subset: v1 }
          weight: 90
        - destination: { host: user-svc, subset: v2 }
          weight: 10
```

- 建议：错误预算驱动切流比例；避免应用内与 Mesh 层重复重试。
