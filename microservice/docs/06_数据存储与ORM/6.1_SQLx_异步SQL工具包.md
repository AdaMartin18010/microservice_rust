# 6.1 SQLx 异步 SQL 工具包

SQLx 提供纯 Rust、异步、编译期校验的 SQL 访问能力，适用于高并发微服务。

## 6.1.1 关键特性

- 异步连接池、编译期 SQL 校验（启用 offline 模式）；
- 支持 Postgres/MySQL/SQLite/MSSQL；
- 与 `tracing`/OpenTelemetry 集成良好。

## 6.1.2 连接与查询示例

```rust
use sqlx::{Pool, Postgres};

pub struct PgRepo { pool: Pool<Postgres> }

impl PgRepo {
    pub async fn new(url: &str) -> anyhow::Result<Self> {
        let pool = Pool::<Postgres>::connect(url).await?;
        Ok(Self { pool })
    }
}
```

## 6.1.3 最佳实践

- 统一超时与连接上限，区分读写连接；
- 显式事务边界；
- 使用结构化迁移（`sqlx migrate`）。
